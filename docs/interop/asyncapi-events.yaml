asyncapi: '2.6.0'
info:
  title: ECS Events (Audit/Async) - Skeleton
  version: 'v1'
servers:
  - url: wss://api.example.com/events
    protocol: wss
channels:
  /events/audit:
    subscribe:
      message:
        name: AuditEvent
        payload:
          $ref: '#/components/schemas/AuditEvent'
  /events/tenant:
    subscribe:
      message:
        name: TenantEvent
        payload:
          $ref: '#/components/schemas/TenantEvent'
  /events/workload:
    subscribe:
      message:
        name: WorkloadEvent
        payload:
          $ref: '#/components/schemas/WorkloadEvent'
components:
  schemas:
    AuditEvent:
      type: object
      description: Evidence-grade audit stream entry (aligned with WS5 evidence catalog)
      properties:
        id: { type: string, description: Unique event id }
        tenant: { type: string }
        type: { type: string, description: Audit event type/category }
        outcome: { type: string, enum: [accepted, refused, failed] }
        occurred_at: { type: string, format: date-time }
        evidence_pointer: { type: string, description: URI/hash to immutable evidence }
        evidence_hash: { type: string, description: Optional hash of event payload/evidence }
        payload: { type: object, description: Event-specific fields (see catalog) }
      required: [id, tenant, type, outcome, occurred_at, evidence_pointer]
    TenantEvent:
      type: object
      description: Tenant lifecycle/bootstrap events with evidence linkage.
      properties:
        id: { type: string }
        tenant: { type: string }
        type: { type: string, enum: [created, updated, suspended, deleted] }
        outcome: { type: string, enum: [accepted, refused, failed] }
        occurred_at: { type: string, format: date-time }
        evidence_pointer: { type: string }
        payload:
          type: object
          description: Tenant snapshot (authority/policy context) at event time.
      required: [id, tenant, type, outcome, occurred_at, evidence_pointer]
    WorkloadEvent:
      type: object
      description: Workload/envelope lifecycle events with integrity hooks.
      properties:
        id: { type: string }
        tenant: { type: string }
        type: { type: string, enum: [admitted, updated, terminated] }
        outcome: { type: string, enum: [accepted, refused, failed] }
        occurred_at: { type: string, format: date-time }
        evidence_pointer: { type: string }
        payload:
          type: object
          description: Envelope declaration, policy snapshot, attestation refs.
      required: [id, tenant, type, outcome, occurred_at, evidence_pointer]
